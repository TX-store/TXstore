<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>تفاصيل المنتج - TXstore</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="back-btn cta-btn">العودة</a>
            <div class="navbar-brand"><h1>TXstore</h1></div>
        </div>
    </nav>

    <main class="container" style="padding:40px 20px;">
        <div id="productDetail" style="display:flex; gap:24px; align-items:flex-start; flex-wrap:wrap;"></div>
    </main>

    <script src="script.js"></script>
    <script>
        function getQueryParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const id = Number(getQueryParam('id'));
            const container = document.getElementById('productDetail');
            if (!id) {
                container.innerHTML = '<p>معرّف المنتج غير صالح. <a href="index.html">العودة للمتجر</a></p>';
                return;
            }

            // products متاحة عبر script.js
            const productList = (typeof products !== 'undefined') ? products : (window.products || []);
            const product = (productList || []).find(p => p.id === id);
            if (!product) {
                container.innerHTML = '<p>لم يتم العثور على المنتج. <a href="index.html">العودة للمتجر</a></p>';
                return;
            }

            const imgSrc = (product.image && product.image.trim()) ? product.image : 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=400&fit=crop';

            container.innerHTML = `
                <div style="flex:1 1 320px; background:white; padding:16px; border-radius:12px; box-shadow:0 4px 18px rgba(0,0,0,0.06);">
                    <img src="${imgSrc}" onerror="this.onerror=null;this.src='${imgSrc}';" alt="${product.name}" style="width:100%; height:360px; object-fit:cover; border-radius:8px; margin-bottom:12px">
                    <h2 style="margin:8px 0">${product.name}</h2>
                    <p style="color:var(--gray-color); margin-bottom:8px">${getCategoryName(product.category)}</p>
                    <p style="font-size:1.4rem; color:var(--primary-color); font-weight:700; margin-bottom:12px">${product.price} ${product.priceType || 'ر.س'}</p>
                    <button id="buyBtn" class="cta-btn">طلب</button>
                </div>
                <div style="flex:1 1 320px; min-width:300px; background:white; padding:16px; border-radius:12px; box-shadow:0 4px 18px rgba(0,0,0,0.06);">
                    <h3>وصف المنتج</h3>
                    <p style="white-space:pre-wrap; color:#333">${product.description || 'لا يوجد وصف متاح.'}</p>
                </div>
            `;

            document.getElementById('buyBtn').addEventListener('click', () => {
                // إضافة المنتج للسلة فقط وعرض إشعار نجاح
                addToCart({
                    id: product.id,
                    name: product.name.replace(/'/g, "\\'"),
                    price: product.price,
                    priceType: product.priceType || 'ريال',
                    image: imgSrc
                });
                if (typeof showNotification === 'function') {
                    showNotification('تمت إضافة المنتج إلى السلة', 'success');
                }
            });
        });
    </script>
</body>
</html>
