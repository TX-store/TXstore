<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>تقييم الخدمة - TXstore</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand"><h1>TXstore</h1></div>
        </div>
    </nav>

    <main class="container" style="padding:40px 20px; text-align:right;">
        <h2>قائمة التقييم</h2>
        <div id="orderInfo" style="margin:16px 0; background:#fff; padding:12px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.06)"></div>

        <form id="ratingForm">
            <label style="display:block; margin-bottom:8px; font-weight:600">تقييمك للخدمة</label>
            <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                <select id="rating" required>
                    <option value="">اختر التقييم</option>
                    <option value="5">5 — ممتاز</option>
                    <option value="4">4 — جيد جداً</option>
                    <option value="3">3 — جيد</option>
                    <option value="2">2 — مقبول</option>
                    <option value="1">1 — ضعيف</option>
                </select>
            </div>

            <label style="display:block; margin-bottom:8px; font-weight:600">ملاحظات (اختياري)</label>
            <textarea id="comment" rows="5" placeholder="شارك رأيك لتحسين خدمتنا..." style="width:100%; padding:12px; border-radius:8px; border:1px solid #eee; margin-bottom:12px"></textarea>

            <button type="submit" class="cta-btn">إرسال التقييم والمتابعة</button>
        </form>
    </main>

    <script>
        // قراءة الطلب المعلق من localStorage
        const pendingRaw = localStorage.getItem('pendingOrder');
        const orderInfoEl = document.getElementById('orderInfo');
        let pending = null;
        if (pendingRaw) {
            try {
                pending = JSON.parse(pendingRaw);
                orderInfoEl.textContent = `طلبك:\n${pending.orderSummary}\n\nالإجمالي: ${pending.total} ر.س`;
            } catch (e) {
                orderInfoEl.textContent = 'لا يوجد بيانات طلب متاحة.';
            }
        } else {
            orderInfoEl.textContent = 'لا يوجد طلب سابق. سيتم إعادة التوجيه إلى المتجر.';
            setTimeout(() => { window.location.href = 'index.html'; }, 1500);
        }

        document.getElementById('ratingForm').addEventListener('submit', function(e){
            e.preventDefault();
            const rating = document.getElementById('rating').value;
            const comment = document.getElementById('comment').value.trim();
            if (!rating) return alert('الرجاء اختيار التقييم.');

            const review = {
                id: Date.now(),
                orderSummary: pending ? pending.orderSummary : '',
                total: pending ? pending.total : 0,
                rating: Number(rating),
                comment,
                createdAt: new Date().toISOString()
            };

            const existing = JSON.parse(localStorage.getItem('reviews') || '[]');
            existing.push(review);
            localStorage.setItem('reviews', JSON.stringify(existing));

            // إزالة الطلب المعلق
            localStorage.removeItem('pendingOrder');

            // إعادة التوجيه إلى قناة الديسكورد بعد إرسال التقييم
            window.location.href = 'https://discord.com/channels/1392667216776003765/1392667218252271801';
        });
    </script>
</body>
</html>
